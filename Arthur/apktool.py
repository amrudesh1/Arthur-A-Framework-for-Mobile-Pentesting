import os
import subprocess
import shutil


class Apktool:
    def decompile_apk(self, apk_path):
        apk_name = os.path.basename(apk_path).split(".")[0]
        temp_dir = "Arthur/temp/{}".format(apk_name)
        if os.path.exists(temp_dir):
            os.removedirs(temp_dir)
        proc = self.runApkTool(["d", apk_path, "-o", temp_dir])
        print(proc.returncode)

    def recompile_apk(self, apk_path):
        print(os.path)

    def runApkTool(self, params):
        if os.name == "nt":
            print("Extracting Contents from APK")
            args = ["apktool.bat"]
            args.extend(params)
            proc = subprocess.Popen(
                args, stdin=subprocess.PIPE, stdout=getStdout())
            proc.communicate(b"\r\n")
            return proc
        else:
            print("Extracting Contents from APK")
            args = ["apktool"]
            args.extend(params)
            return subprocess.run(args, stdout=self.getStdout())

    def getStdout():
        return subprocess.DEVNULL
