import os
import subprocess
import shutil


class Apktool:
    def decompile_as_java(self, apk_path):
        print(os.path.abspath(apk_path))
        # return_code, temp_dir = self.decompile_apk(apk_path)
        # if return_code == 0:
        #     print("Converting Smali to JAR")
        #     print(os.path(apk_path))
        # else:
        #     print("Error Decompiling APK")

    def decompile_apk(self, apk_path):
        apk_name = os.path.basename(apk_path).split(".")[0]
        temp_dir = "Arthur/temp/{}".format(apk_name)
        if os.path.exists(temp_dir):
            os.removedirs(temp_dir)
        print("Extracting Contents from APK")
        proc = self.runApkTool(["d", apk_path, "-o", temp_dir])
        return proc.returncode, temp_dir

    def recompile_apk(self, apk_path):
        print(os.path)

    def runApkTool(self, params):
        if os.name == "nt":
            print("Extracting Contents from APK")
            args = ["apktool.bat"]
            args.extend(params)
            proc = subprocess.Popen(
                args, stdin=subprocess.PIPE, stdout=getStdout())
            proc.communicate(b"\r\n")
            return proc
        else:
            print("Extracting Contents from APK")
            args = ["apktool"]
            args.extend(params)
            return subprocess.run(args, stdout=getStdout())


def getStdout():
    return None
